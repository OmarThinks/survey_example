<!DOCTYPE html>
<html>
<head>
	<title>Screen 2</title>
<style type="text/css">
*{
	font-family: arial;
	transition: .5s;
}


table
{
	width: 100%;
	margin: 0px;
	border-collapse: collapse;

}

th,td{
	align-content: center;
	
	margin: 0px;
	padding: .5em .75em;
	font-size: 1.3em;
	border: 0px;
	border: solid 1px black;
}


th{background: lime;text-align: left;}
td{background: white;text-align: center;}
.no-border{
	border-width: 0px;
}
.err_message{
	color: red;
}


#percentage_6
{}


a, a:hover,a:visited, a:active{text-decoration: none}


.nav_button
{
	margin: 2em;padding: .8em;font-size: 1.2em;
	font-weight: bold;background: blue;
	color: white;
	border-radius: 1em;
	border:solid 2px blue;
}

.nav_button:hover
{
	color: black;
	background: lightblue;
}



</style>


</head>
<body>

<h1>Which of the following security methods have we used in the last 12 Months?</h1>


Select all that apply.



<table>
	<tr>
		<td class="no-border" style="width: 60%;"></td>
		<th style="width: 20%;text-align: center;">Used in the last 12 months</th>
		<th style="width: 20%;text-align: center;">Percentage of our investments</th>
	</tr>
<tr>
	<th>I traded on my own using online brokerage</th>
	<td style="width: 20%;" id="checkbox_container_0"><input id="checkbox_0" type="checkbox" name="choice_0"></td>
	<td style="width: 20%;"><input id="percentage_0" type="text" name="percentage_0"> %
		<div id="err_message_0" class="err_message"></div>
	</td>
</tr>
<tr>
	<th>I used an online service to automatically invest</th>
	<td style="width: 20%;" id="checkbox_container_1"><input id="checkbox_1" type="checkbox" name="choice_1"></td>
	<td style="width: 20%;"><input id="percentage_1" type="text" name="percentage_1"> %
		<div id="err_message_1" class="err_message"></div>
	</td>
</tr>
<tr>
	<th>A bank or other professional</th>
	<td style="width: 20%;" id="checkbox_container_2"><input id="checkbox_2" type="checkbox" name="choice_2"></td>
	<td style="width: 20%;"><input id="percentage_2" type="text" name="percentage_2"> %
		<div id="err_message_2" class="err_message"></div>
	</td>
</tr>
<tr>
	<th>A family member</th>
	<td style="width: 20%;" id="checkbox_container_3"><input id="checkbox_3" type="checkbox" name="choice_3"></td>
	<td style="width: 20%;"><input id="percentage_3" type="text" name="percentage_3"> %
		<div id="err_message_3" class="err_message"></div>
	</td>
</tr>
<tr>
	<th>I did not trade, and do not intend</th>
	<td style="width: 20%;" id="checkbox_container_4"><input id="checkbox_4" type="checkbox" name="choice_4"></td>
	<td style="width: 20%;"><input id="percentage_4" type="text" name="percentage_4"> %
		<div id="err_message_4" class="err_message"></div>
	</td>
</tr>
<tr>
	<th>I did not trade, but I intend</th>
	<td style="width: 20%;" id="checkbox_container_5"><input id="checkbox_5" type="checkbox" name="choice_5"></td>
	<td style="width: 20%;"><input id="percentage_5" type="text" name="percentage_5"> %
		<div id="err_message_5" class="err_message"></div>
	</td>
</tr>
<tr>
	<th>I am not sure</th>
	<td id="checkbox_container_6" style="width: 20%;"><input id="checkbox_6" type="checkbox" name="choice_6"></td>
	<td style="width: 20%;"><input id="percentage_6" type="text" name="percentage_6"> %
		<div id="err_message_6" class="err_message"></div>
	</td>
</tr>
<tr>
	<th>Other (Please specify)</th>
	<td id="checkbox_container_7" style="width: 20%;"><input id="checkbox_7" type="checkbox" name="choice_7"></td>
	<td style="width: 20%;"><input id="percentage_7" type="text" name="percentage_7" disabled> %
	<div id="err_message_7" class="err_message"></div>
	</td>
</tr>
<tr>
	<th>Number of methods selected</th>
	<td id="sum_checked">0</td>
	<td>
		<div id="sum_percentage">0</div>
		<div id="sum_percentage_error" class="err_message"></div>
	</td>
</tr>

</table>


<div style="display: flex;justify-content: center;">
<a href="screen_1.html">
	
	<button class="nav_button">&lt;&lt; Back</button>
</a>
<a href="screen_3.html">
	<button class="nav_button">Continue &gt;&gt;</button>
</a>
</div>



<script type="text/javascript">

function isNumeric(value)
{return /^\d+$/.test(value);}



class Spending{
	constructor(spending_number)
	{
		this.number = spending_number;
		this.checkbox_element = document.getElementById(
			'checkbox_'+this.number.toString());
		this.checkbox_container = this.checkbox_element.offsetParent;
		this.percentage_element = document.getElementById(
			'percentage_'+this.number.toString());
		this.err_message_element = document.getElementById(
			'err_message_'+this.number.toString());
	}
	get_checked()
	{return this.checkbox_element.checked;
	}
	percentage_is_valid()
	{
		if (this.percentage_element.value == "")
		{return true;}
		if(isNumeric(this.percentage_element.value)){return true;}
		else{return false;}
	}
	get_percentage()
	{
		if (this.percentage_element.value == "")
		{return 0;}
		if (this.get_checked())
		{
			if (this.percentage_is_valid()) 
			{return parseInt(this.percentage_element.value);}
			else{return 0;}
		}
		else{return 0;}
	}
	validate_percentage()
	{
		if (this.percentage_element.value=="")
		{
			if (this.get_checked()) {
				this.set_err_message("This percetage should not be empty");
				return false;
			}
		}
		if (this.percentage_is_valid()) 
		{
			this.unset_err_message();
			return true;
		}
		else
		{
			this.set_err_message("This should be a number");
			return false;
		}

	}
	
	set_err_message(new_message)
	{this.err_message_element.innerHTML = new_message;}
	unset_err_message()
	{this.set_err_message("");}
	
	set_percentage(new_value){
		this.percentage_element.value=new_value;

	}
	enable_percentage(new_message)
	{
		this.percentage_element.disabled = false;
		this.percentage_element.value="";
		this.unset_err_message();
	}
	disable_percentage(new_message)
	{
		this.percentage_element.disabled = true;
		this.percentage_element.value="";
		this.unset_err_message();
	}
	check()
	{
		this.checkbox_element.checked = true;
		this.enable_percentage();
	}
	uncheck()
	{
		this.checkbox_element.checked = false;
		this.disable_percentage();
	}
	reverse_checked()
	{
		if (this.get_checked()) {this.uncheck();}
		else{this.check();}
	}
}

var spendings = [];
spendings[0] = new Spending(0);
spendings[1] = new Spending(1);
spendings[2] = new Spending(2);
spendings[3] = new Spending(3);
spendings[4] = new Spending(4);
spendings[5] = new Spending(5);
spendings[6] = new Spending(6);
spendings[7] = new Spending(7);



function get_target_number(event)
{
	let splitted = event.target.id.split("_");
	return parseInt(splitted[splitted.length-1]);
}






function check_percetage()
{
	let sum_of_percentages= 0;
	let all_valid = true;
	for (var i = spendings.length - 1; i >= 0; i--) 
	{
		spendings[i].validate_percentage()
		sum_of_percentages += spendings[i].get_percentage();
		if (!spendings[i].percentage_is_valid())
		{all_valid=false;}
	}
	document.getElementById(
		"sum_percentage").innerHTML = sum_of_percentages.toString();
	
	document.getElementById('sum_percentage_error').innerHTML = "";
	document.getElementById('sum_percentage').style.color="black";		

	if (all_valid)
	{
		if (sum_of_percentages!=100){
			document.getElementById('sum_percentage_error').innerHTML = 
			"Some of percetage should be equal to 100";
			document.getElementById('sum_percentage').style.color="red";		
		}
	}
}






function handle_checkbox_event(event)
{
	let spending_number = get_target_number(event);
	spendings[spending_number].reverse_checked();
	let sum_of_checked = 0;
	for (var i = spendings.length - 1; i >= 0; i--) {
		if ( (spending_number ==4) ||(spending_number ==5)||
		(spending_number ==6) ){
			if (i!=spending_number) {spendings[i].uncheck();}
		}
		else
		{spendings[4].uncheck();spendings[5].uncheck();spendings[6].uncheck();}
		if (spendings[i].get_checked()){sum_of_checked +=1;}
	}
	document.getElementById("sum_checked").innerHTML = sum_of_checked.toString();
	check_percetage();
}








//console.log(spendings);



for (var i = spendings.length - 1; i >= 0; i--) {
	spendings[i].uncheck();
	spendings[i].checkbox_element.addEventListener(
		"click",(e)=>{handle_checkbox_event(e);});
	spendings[i].checkbox_container.addEventListener(
		"click",(e)=>{handle_checkbox_event(e);});
	spendings[i].percentage_element.addEventListener(
		"input",(e)=>{check_percetage();});

}


//console.log(document.getElementById("sum_percentage_error"));

</script>








</body>
</html>